{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 2fcff49344f3179bafc3","webpack:///./lib/index.js","webpack:///./lib/handler.js","webpack:///external \"http\"","webpack:///./lib/error-handler.js","webpack:///external \"easy-slack\"","webpack:///external \"uuid\"","webpack:///./lib/helpers.js"],"names":["handler","require","module","exports","http","errorHandler","helpers","promise","options","event","context","callback","response","OutgoingMessage","Object","assign","statusCode","headers","Allow","request","IncomingMessage","body","callbackWaitsForEmptyEventLoop","requiresBody","undefined","console","error","JSON","parse","pathParameters","handleMiddlewares","then","stringify","catch","slack","uuid","Error","slackError","toJSON","postMessage","text","attachments","color","title","message","fields","keys","map","key","value","short","footer","name","code","process","env","environment","stack","createSnippet","err","headersToLowerCase","forEach","header","toLowerCase","middlewares","length","promises","middleware","Promise","all","resolve"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"http\"), require(\"easy-slack\"), require(\"uuid\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"promise-handler\", [\"http\", \"easy-slack\", \"uuid\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"promise-handler\"] = factory(require(\"http\"), require(\"easy-slack\"), require(\"uuid\"));\n\telse\n\t\troot[\"promise-handler\"] = factory(root[\"http\"], root[\"easy-slack\"], root[\"uuid\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_5__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2fcff49344f3179bafc3","'use strict';\n\nconst handler = require('./handler');\n\nmodule.exports = handler;\n\n\n\n// WEBPACK FOOTER //\n// ./lib/index.js","'use strict';\n\nconst http = require('http');\nconst errorHandler = require('./error-handler');\nconst helpers = require('./helpers');\n\nmodule.exports = (promise, options) => (event, context, callback) => {\n  const response = new http.OutgoingMessage();\n  Object.assign(response, {\n    statusCode: 200,\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS, HEAD, PUT, DELETE',\n      Allow: 'GET, POST, OPTIONS, HEAD, PUT, DELETE',\n    },\n  });\n\n  const request = new http.IncomingMessage();\n  Object.assign(request, {\n    body: null,\n  });\n\n  context.callbackWaitsForEmptyEventLoop = false;\n\n  if (event && !event.body &&\n    (!options || options.requiresBody === undefined\n    || options.requiresBody)) {\n    console.error('failure', 'No body at the request');\n    request.body = 'No body at the request';\n    response.headers['Content-Type'] = 'text/plain';\n    return callback(null, {\n      body: response.body,\n      statusCode: response.statusCode,\n      headers: response.headers,\n    });\n  }\n  if (event && event.body) {\n    try {\n      request.body = JSON.parse(event.body);\n    } catch (error) {\n      console.error('Error parsing JSON ', event.body, error);\n      return callback(error);\n    }\n  }\n\n  if (event) {\n    request.pathParameters = event.pathParameters;\n\n    request.headers = event.headers;\n  }\n  helpers.handleMiddlewares(request, response, options)\n  .then(() => promise(request, response, event, context)\n    .then((body) => {\n      if (body && !response.body) {\n        response.body = body;\n      }\n      callback(null, {\n        body: JSON.stringify(response.body),\n        statusCode: response.statusCode,\n        headers: response.headers,\n      });\n    })\n    .catch(error => errorHandler(error, response, context, callback)))\n    .catch(error => errorHandler(error, response, context, callback));\n};\n\n\n\n// WEBPACK FOOTER //\n// ./lib/handler.js","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 2\n// module chunks = 0","const slack = require('easy-slack');\nconst uuid = require('uuid');\n\nmodule.exports = (error, response, context, callback) => {\n  if (!error) {\n    // bot.postMessageToChannel('errors', 'unknown error');\n    callback(new Error('unknown error'));\n  }\n  console.error(error);\n  if (response.statusCode === 200 && !error.statusCode) {\n    response.statusCode = 500;\n  }\n  if (error.statusCode) {\n    response.statusCode = error.statusCode;\n  }\n  let slackError;\n  error.uuid = uuid();\n  if (error.toJSON) {\n    slackError = slack.postMessage('errors', {\n      text: 'An error has been thrown by the server',\n      attachments: [{\n        color: 'danger',\n        title: error.message,\n        fields: Object.keys(error).map(key => (key !== 'stack' ? ({ title: key, value: error[key], short: true }) : undefined)),\n        footer: error.name,\n      }],\n    });\n  } else {\n    slackError = slack.postMessage('errors', {\n      text: 'An error has been thrown by the server',\n      attachments: [{\n        title: error.message,\n        color: 'danger',\n        fields: [\n          { title: 'Message', value: error.message },\n          { title: 'Code', value: error.code },\n          { title: 'UUID', value: error.uuid },\n          { title: 'Environment', value: process.env.environment },\n        ],\n      }],\n    });\n  }\n\n  slackError.then(() => error.stack && slack.createSnippet('errors', 'Stack error', error.stack))\n  .then(() => callback(null, {\n    statusCode: response.statusCode || 500,\n    headers: response.headers,\n    body: error.toJSON ? error.toJSON() : JSON.stringify({\n      message: error.message,\n      code: error.code,\n      stack: error.stack,\n      uuid: error.uuid,\n    }),\n  }))\n  .catch(err => callback(null, {\n    statusCode: response.statusCode || 500,\n    headers: response.headers,\n    body: error.toJSON ? error.toJSON() : JSON.stringify({\n      message: error.message,\n      code: error.code,\n      stack: error.stack,\n      uuid: error.uuid,\n      slackError: err,\n    }),\n  }));\n};\n\n\n\n// WEBPACK FOOTER //\n// ./lib/error-handler.js","module.exports = __WEBPACK_EXTERNAL_MODULE_4__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"easy-slack\"\n// module id = 4\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_5__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid\"\n// module id = 5\n// module chunks = 0","function headersToLowerCase(request) {\n  if (request && request.headers) {\n    Object.keys(request.headers).forEach((header) => {\n      request.headers[header.toLowerCase()] = request.headers[header];\n    });\n  }\n}\n\nmodule.exports = {\n  handleMiddlewares(request, response, options) {\n    headersToLowerCase(request);\n    if (options && options.middlewares && options.middlewares.length > 0) {\n      const promises = options.middlewares.map(middleware => middleware(request, response));\n      return Promise.all(promises);\n    } else {\n      return Promise.resolve();\n    }\n  },\n};\n\n\n\n// WEBPACK FOOTER //\n// ./lib/helpers.js"],"sourceRoot":""}